(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18286dfb"],{2934:function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"d",(function(){return n})),a.d(e,"c",(function(){return r})),a.d(e,"e",(function(){return l})),a.d(e,"a",(function(){return i}));var s=a("66df"),o=function(t){return s["a"].request({url:"api/get_captcha",method:"get"})},n=function(t){return s["a"].request({url:"/api/common_get_table_status/"+t,method:"get"})},r=function(t){return s["a"].request({url:"/api/common_get_config_file_data",data:{config_item:t},method:"post"})},l=function(t,e,a){return s["a"].request({url:"/api/common_switch_enable",data:{id:t,table:e,value:a},method:"post"})},i=function(t,e,a,o){return s["a"].request({url:"/api/common_edit_talbe_column",data:{id:t,table:e,column:a,value:o},method:"post"})}},"2e66":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"ivu-mt ivu-card ivu-card-dis-hover"},[a("Card",[a("Form",{ref:"tableSearchForm",attrs:{model:t.searchForm,inline:"","label-width":90}},[a("Row",[a("Col",[a("FormItem",{attrs:{label:"消息类型",prop:"message_type"}},[a("Select",{attrs:{placeholder:"请选择"},model:{value:t.searchForm.message_type,callback:function(e){t.$set(t.searchForm,"message_type",e)},expression:"searchForm.message_type"}},[a("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._l(t.tableStatus.message_type,(function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e))])}))],2)],1),a("FormItem",{attrs:{label:"是否已读",prop:"is_read"}},[a("Select",{attrs:{placeholder:"请选择"},model:{value:t.searchForm.is_read,callback:function(e){t.$set(t.searchForm,"is_read",e)},expression:"searchForm.is_read"}},[a("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._l(t.tableStatus.is_read,(function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e))])}))],2)],1),a("FormItem",{attrs:{label:"发送人手机",prop:"send_user_mobile"}},[a("Input",{attrs:{icon:"search",placeholder:"请输入发送人手机号搜索..."},model:{value:t.searchForm.send_user_mobile,callback:function(e){t.$set(t.searchForm,"send_user_mobile",e)},expression:"searchForm.send_user_mobile"}})],1)],1),a("Col",{staticClass:"text-right"},[a("FormItem",{staticClass:"right-float"},[a("Button",{staticClass:"margin-right-10",attrs:{type:"primary"},on:{click:function(e){return t.getTableDataExcute(1)}}},[t._v(t._s(t.$t("queryBtn"))+"\n              ")]),a("Button",{attrs:{type:"default"},on:{click:function(e){return t.handleReset("tableSearchForm")}}},[t._v(t._s(t.$t("resetBtn")))])],1)],1)],1)],1),a("Row",{attrs:{gutter:24}},[a("Col",{attrs:{xs:6,lg:2}},[a("Button",{attrs:{type:"success",icon:"plus"},on:{click:function(e){return t.addBtn()}}},[t._v("发消息")])],1),a("Col",{staticClass:"hidden-mobile",attrs:{xs:0,lg:2}},[a("Poptip",{attrs:{confirm:"",placement:"bottom",title:"确认要删除选中的数据?","ok-text":"确认","cancel-text":"点错了"},on:{"on-ok":function(e){return t.batchDestroyExcute(t.selectIds)}}},[a("Button",{attrs:{type:"error",loading:t.loadingBatchDestroy}},[t.loadingBatchDestroy?a("span",[t._v("删除中...")]):a("span",[t._v("删除")])])],1)],1)],1),a("br"),a("Row",[t.tableLoading?a("div",{staticClass:"demo-spin-container"},[a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"load-c",size:"18"}}),a("div",[t._v(t._s(t.$t("table_loading")))])],1)],1):t._e(),a("Table",{staticClass:"no-border-table",attrs:{columns:t.columns,data:t.feeds.data},on:{"on-sort-change":t.onSortChange,"on-selection-change":t.onSelectionChange},scopedSlots:t._u([{key:"send_user",fn:function(e){var a=e.row;e.index;return[t._v("\n            "+t._s(a.admin_user.real_name)+"\n          ")]}},{key:"recive_user",fn:function(e){var a=e.row;e.index;return[t._v("\n            "+t._s(a.user.real_name)+"\n          ")]}},{key:"message_type",fn:function(e){var a=e.row;e.index;return[t._v("\n            "+t._s(t.tableStatus.message_type[a.message_type])+"\n          ")]}},{key:"is_read",fn:function(e){var a=e.row;e.index;return[t._v("\n            "+t._s(t.tableStatus.is_read[a.is_read])+"\n          ")]}},{key:"action",fn:function(e){var s=e.row,o=e.index;return[a("a",{staticClass:"color-primary margin-right-5",attrs:{type:"text"},on:{click:function(e){return t.tableButtonShowInfo(s,o)}}},[t._v(t._s(t.$t("show_info"))+"\n            ")]),a("Divider",{attrs:{type:"vertical"}}),a("a",{staticClass:"color-primary margin-right-5",attrs:{type:"text"},on:{click:function(e){return t.tableButtonDestroyOk(s,o)}}},[t._v(t._s(t.$t("destroy"))+"\n            ")])]}}])}),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{staticClass:"paging",attrs:{total:t.feeds.total,current:t.feeds.current_page,"page-size":t.feeds.per_page,"show-elevator":"","show-total":"","show-sizer":""},on:{"on-change":t.handleOnPageChange,"on-page-size-change":t.onPageSizeChange}})],1)])],1)],1)],1),t.addModal.show?a("add-component",{attrs:{tableStatus_is_alert_at_home:t.tableStatus.is_alert_at_home,tableStatus_message_type:t.tableStatus.message_type},on:{"on-add-modal-success":function(e){return t.getTableDataExcute(t.feeds.current_page)},"on-add-modal-hide":t.addModalHide}}):t._e(),t.showInfoModal.show?a("show-info",{attrs:{info:t.showInfoModal.info},on:{"show-modal-close":t.showModalClose}}):t._e()],1)},o=[],n=(a("cc57"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{"mask-closable":!1,width:"600"},on:{"on-cancel":t.cancel},model:{value:t.modalShow,callback:function(e){t.modalShow=e},expression:"modalShow"}},[a("p",{attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.$t("add")))]),a("Form",{ref:"formData",attrs:{model:t.formData,rules:t.rules,"label-position":"right","label-width":100}},[a("FormItem",{attrs:{label:"标题",prop:"title"}},[a("Input",{attrs:{placeholder:"请输消息标题"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),a("FormItem",{attrs:{label:"消息内容",prop:"content"}},[a("Input",{attrs:{type:"textarea",placeholder:"请输入消息内容"},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1),a("FormItem",{attrs:{label:"消息类型"}},[a("Select",{attrs:{filterable:"",placeholder:"请选择消息类型"},model:{value:t.formData.message_type,callback:function(e){t.$set(t.formData,"message_type",e)},expression:"formData.message_type"}},t._l(t.tableStatus_message_type,(function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e)+" ")])})),1)],1),a("FormItem",{attrs:{label:"在首页提示"}},[a("RadioGroup",{model:{value:t.formData.is_alert_at_home,callback:function(e){t.$set(t.formData,"is_alert_at_home",e)},expression:"formData.is_alert_at_home"}},t._l(t.tableStatus_is_alert_at_home,(function(e,s){return a("Radio",{key:s,attrs:{label:s}},[t._v(t._s(e))])})),1)],1),a("FormItem",{attrs:{label:"消息接收人"}},[a("Select",{attrs:{multiple:"",filterable:"",remote:"","remote-method":t.searchUserPassMobileExcute,loading:t.searchLoading,placeholder:"请输入手机号搜索"},model:{value:t.formData.users,callback:function(e){t.$set(t.formData,"users",e)},expression:"formData.users"}},t._l(t.userList,(function(e,s){return a("Option",{key:s,attrs:{value:e.id}},[t._v(t._s(e.real_name)+"("+t._s(e.mobile)+")")])})),1),a("input-helper",{attrs:{text:"不选将发送给所有人","style-class":"input-helper-error"}})],1),a("FormItem",{attrs:{label:"跳转 url"}},[a("Input",{attrs:{placeholder:"跳转 url"},model:{value:t.formData.url,callback:function(e){t.$set(t.formData,"url",e)},expression:"formData.url"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text"},on:{click:t.cancel}},[t._v(t._s(t.$t("cancel")))]),a("Button",{attrs:{type:"primary",loading:t.saveLoading},on:{click:t.sendMessageToAppUserExcute}},[t._v(t._s(t.$t("save"))+" ")])],1)],1)],1)}),r=[],l=a("66df"),i=function(t,e,a){return l["a"].request({url:"/api/admin/app_messages",params:{page:t,per_page:e,search_data:JSON.stringify(a)},method:"get"})},c=function(t){return l["a"].request({url:"/api/admin/app_messages/send_message_to_app_user",data:t,method:"post"})},u=function(t){return l["a"].request({url:"/api/admin/app_messages/"+t,method:"delete"})},d=function(t){return l["a"].request({url:"/api/admin/app_messages/"+t+"/batch",method:"delete"})},m=a("c24f"),_=a("9f69"),h={props:["tableStatus_message_type","tableStatus_is_alert_at_home"],components:{InputHelper:_["a"]},data:function(){return{modalShow:!0,saveLoading:!1,searchLoading:!1,userList:[],formData:{title:"",message_type:"",url:"",users:"",content:"",is_alert_at_home:"F"},rules:{title:[{required:!0,message:"请填写消息标题",trigger:"blur"}],content:[{required:!0,message:"请填写消息内容",trigger:"blur"}],type:[{required:!0,message:"请选择消息类型",trigger:"blur"}]}}},methods:{searchUserPassMobileExcute:function(t){var e=this,a=this;if(t.length<3)return!1;a.searchLoading=!0,Object(m["m"])(t).then((function(t){e.userList=t.data,a.searchLoading=!1}))},sendMessageToAppUserExcute:function(){var t=this;t.$refs.formData.validate((function(e){e&&(t.saveLoading=!0,c(t.formData).then((function(e){t.saveLoading=!1,t.modalShow=!1,t.$emit("on-add-modal-success"),t.$emit("on-add-modal-hide"),t.$Notice.success({title:e.message})})))}))},cancel:function(){this.modalShow=!1,this.$emit("on-add-modal-hide")}}},f=h,p=a("5511"),g=Object(p["a"])(f,n,r,!1,null,null,null),b=g.exports,v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Drawer",{attrs:{closable:!0,title:"消息详情",width:t.platformIsPc?30:80},on:{"on-close":t.closed},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("div",{staticClass:"drawer-profile"},[a("Row",[a("li",[a("span",{staticClass:"blod-font"},[t._v("消息标题：")]),t._v(" "+t._s(t.info.title)+" ")]),t.info.admin_user?a("li",[a("span",{staticClass:"blod-font"},[t._v("发送人：")]),t._v(t._s(t.info.admin_user.real_name)+" ("+t._s(t.info.admin_user.mobile)+") ")]):t._e(),t.info.user?a("li",[a("span",{staticClass:"blod-font"},[t._v(" 接收人：")]),t._v(t._s(t.info.user.real_name)+" ("+t._s(t.info.user.mobile)+") ")]):t._e()]),a("h2",{staticClass:"text-center margin-top-8"},[t._v("消息内容")]),a("div",{staticClass:"text-center",domProps:{innerHTML:t._s(t.info.content)}})],1)])],1)},y=[],w={props:{info:{type:Object,default:""}},data:function(){return{show:!0,agreement:""}},computed:{platformIsPc:function(){return"pc"===this.globalPlatformType()}},methods:{closed:function(){this.show=!1,this.$emit("show-modal-close")}}},x=w,k=Object(p["a"])(x,v,y,!1,null,null,null),S=k.exports,D=a("2934"),C=a("90de"),I=a("61b5"),$={components:{AddComponent:b,ShowInfo:S},data:function(){return{searchForm:{order_by:"created_at,desc",message_type:"",is_read:"",is_alert_at_home:"",send_user_mobile:""},notRealySortKey:[],tableLoading:!1,loadingBatchDestroy:!1,selectIds:"",tableStatus:{message_type:[],is_read:[],is_alert_at_home:[]},feeds:{data:[],total:0,current_page:1,per_page:10},addModal:{show:!1},showInfoModal:{show:!1,info:""},columns:[{type:"selection",width:60,align:"center"},{title:"ID",key:"id",sortable:"customer",minWidth:100},{title:"标题",key:"title",minWidth:100},{title:"发送人",key:"send_user",minWidth:80,slot:"send_user"},{title:"接收人",key:"recive_user",minWidth:80,slot:"recive_user"},{title:"消息类型",minWidth:100,slot:"message_type"},{title:"是否已读",minWidth:40,slot:"is_read"},{title:"内容",key:"content",tooltip:!0,minWidth:100},{title:"创建时间",key:"created_at",minWidth:150},{title:"更新录时间",key:"updated_at",sortable:"customer",minWidth:150},{title:"操作",key:"",minWidth:100,slot:"action"}]}},created:function(){var t=this;t.getTableStatusExcute("app_messages")},methods:{handleReset:function(t){this.$refs[t].resetFields()},handleOnPageChange:function(t){this.getTableDataExcute(t)},onPageSizeChange:function(t){this.feeds.per_page=t,this.getTableDataExcute(this.feeds.current_page)},getTableStatusExcute:function(t){var e=this;Object(D["d"])(t).then((function(t){e.tableStatus.message_type=t.data.message_type,e.tableStatus.is_read=t.data.is_read,e.tableStatus.is_alert_at_home=t.data.is_alert_at_home,e.getTableDataExcute(e.feeds.current_page)}))},getTableDataExcute:function(t){var e=this;e.tableLoading=!0,e.feeds.current_page=t,i(t,e.feeds.per_page,e.searchForm).then((function(t){e.feeds.data=t.data,e.feeds.total=t.meta.total,e.tableLoading=!1}),(function(t){e.tableLoading=!1}))},onSortChange:function(t){var e=t.column.key+","+t.order;Object(C["i"])(t.column.key,this.notRealySortKey)||(this.searchForm.order_by=e,this.getTableDataExcute(this.feeds.current_page))},onSelectionChange:function(t){for(var e in this.selectIds="",t)this.selectIds+=","+t[e].id},tableButtonDestroyOk:function(t,e){var a=this;I["Modal"].confirm({title:"确定要删除id为 "+t.id+" 的数据吗?",onOk:function(){u(t.id).then((function(t){a.feeds.data.splice(e,1),a.$Notice.success({title:t.message})}))},onCancel:function(){}})},addBtn:function(){this.addModal.show=!0},addModalHide:function(){this.addModal.show=!1},batchDestroyExcute:function(t){if(!t)return this.$Notice.error({title:"出错了",desc:"请先选择要操作的项"}),!1;var e=this;e.loadingBatchDestroy=!0,d(t).then((function(t){e.getTableDataExcute(e.feeds.current_page),e.loadingBatchDestroy=!1}))},tableButtonShowInfo:function(t,e){this.showInfoModal.show=!0,this.showInfoModal.info=t},showModalClose:function(){this.showInfoModal.show=!1}}},F=$,M=Object(p["a"])(F,s,o,!1,null,null,null);e["default"]=M.exports},"9f69":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("Icon",{attrs:{type:t.type}}),a("span",{class:t.styleClass},[t._v(t._s(t.text))])],1)},o=[],n={props:{styleClass:{type:String,default:"color-light-gray"},type:{type:String,default:"md-information"},text:{type:String,default:"温馨提示..."}}},r=n,l=a("5511"),i=Object(l["a"])(r,s,o,!1,null,null,null);e["a"]=i.exports}}]);